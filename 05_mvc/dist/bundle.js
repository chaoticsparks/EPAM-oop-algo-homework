(()=>{"use strict";class e{constructor(e,t,s,n,r,i,u){this.converterInputsView=e,this.converterSlidersView=t,this.controlsView=s,this.panelView=n,this.individualFieldsModel=r,this.allFieldsModel=i,this.modelKey=u,this.converterView=e,this.setModel(r),this.initializeViewListeners()}initializeViewListeners(){this.setConverterListeners(this.converterInputsView),this.setConverterListeners(this.converterSlidersView),this.setConrolsListeners()}setModel(e){this.model=e,this.model.attachObserver(this),this.update()}setConverterListeners(e){e.setEurListener((()=>{this.model.updateEurAmount(this.modelKey,Number(e.getEurValue()))})),e.setRateListener&&e.setRateListener((()=>{e.getRateValue&&this.model.updateRate(this.modelKey,Number(e.getRateValue()))})),e.setConvertedListener((()=>{this.model.updateConvertedAmount(this.modelKey,Number(e.getConvertedValue()))}))}setConrolsListeners(){this.controlsView.setModeIndividualInputListener((()=>{this.setModel(this.individualFieldsModel)})),this.controlsView.setModeAllInputListener((()=>{this.setModel(this.allFieldsModel)})),this.controlsView.setControlSlidersInputListener((()=>{this.panelView.showPanelWithSliders(),this.converterView=this.converterSlidersView,this.update()})),this.controlsView.setControlFieldsInputListener((()=>{this.panelView.showPanelWithInputs(),this.converterView=this.converterInputsView,this.update()}))}update(){const{eur:e,exchangeRate:t,converted:s}=this.model.getModel(this.modelKey);this.converterView.setEurValue(String(e)),this.converterView.setRateValue(String(t)),this.converterView.setConvertedValue(String(s))}}class t extends class{constructor(e){this.stateSubject=e}attachObserver(e){this.stateSubject.attach(e)}getModel(e){return this.stateSubject.getState(e)}}{}class s{constructor(e){this.observers=[],this.state=Object.assign({},e)}updateState(e,t){this.state[e]=Object.assign(Object.assign({},this.state[e]),t),this.notify()}setState(e){this.state=Object.assign({},e)}getState(e){return e?this.state[e]:this.state}attach(e){if(this.observers.includes(e))return console.log("Subject: Observer has been attached already.");console.log("Subject: Attached an observer."),this.observers.push(e)}detach(e){const t=this.observers.indexOf(e);if(-1===t)return console.log("Subject: Nonexistent observer.");this.observers.splice(t,1),console.log("Subject: Detached an observer.")}notify(){console.log("Subject: Notifying observers...");for(const e of this.observers)e.update(this)}}var n;!function(e){e.EurToUsd="eurToUsd",e.EurToUah="eurToUah",e.EurToGbr="eurToGbr"}(n||(n={}));class r{static getStateSubject(){return new s(r.getInitialState())}static getInitialState(){const{exchangeRates:{eur:{usd:e,gbr:t,uah:s}}}={exchangeRates:{eur:{usd:1.18,uah:32.27,gbr:.85}}};return{eurToUsd:{eur:1,exchangeRate:e,converted:e},eurToUah:{eur:1,exchangeRate:s,converted:s},eurToGbr:{eur:1,exchangeRate:t,converted:t}}}}class i{constructor(e){if(null===document.querySelector(`[data-viewRoot=${e}]`))throw new Error("Wrong selector for converter view");this.viewRoot=e}getInputElement(e){return this.getElement(e,"input")}getHTMLElement(e){return this.getElement(e,"element")}getElement(e,t){const s=document.querySelector(`[data-viewRoot=${this.viewRoot}] [data-${t}=${e}]`);if(!s)throw new Error(`No element found in DOM with data-${t}=${e}`);return s}static setOnInputListener(e,t){e.addEventListener("input",t)}}class u extends i{getEurValue(){return this.getInputElement("euro").value}getRateValue(){return this.getInputElement("rate").value}getConvertedValue(){return this.getInputElement("converted").value}setEurValue(e){this.getInputElement("euro").value=e}setRateValue(e){this.getInputElement("rate").value=e}setConvertedValue(e){this.getInputElement("converted").value=e}setEurListener(e){i.setOnInputListener(this.getInputElement("euro"),e)}setRateListener(e){i.setOnInputListener(this.getInputElement("rate"),e)}setConvertedListener(e){i.setOnInputListener(this.getInputElement("converted"),e)}}class o extends i{getEurValue(){return this.getInputElement("euro").value}getConvertedValue(){return this.getInputElement("converted").value}setEurValue(e){this.getInputElement("euro").value=e,this.getHTMLElement("euro").innerText=e}setConvertedValue(e){this.getInputElement("converted").value=e,this.getHTMLElement("converted").innerText=e}setRateValue(e){this.getHTMLElement("rate").innerText=e}setEurListener(e){i.setOnInputListener(this.getInputElement("euro"),e)}setConvertedListener(e){i.setOnInputListener(this.getInputElement("converted"),e)}}const a=r.getStateSubject(),l=new class extends t{updateEurAmount(e,t){const{exchangeRate:s}=this.stateSubject.getState(e);this.stateSubject.updateState(e,{eur:t,converted:t*s})}updateRate(e,t){const{eur:s}=this.stateSubject.getState(e);this.stateSubject.updateState(e,{exchangeRate:t,converted:s*t})}updateConvertedAmount(e,t){const{exchangeRate:s}=this.stateSubject.getState(e);this.stateSubject.updateState(e,{eur:t/s,converted:t})}}(a),d=new class extends t{updateEurAmount(e,t){this.updateEurAmountModel(n.EurToGbr,t),this.updateEurAmountModel(n.EurToUah,t),this.updateEurAmountModel(n.EurToUsd,t)}updateEurAmountModel(e,t){this.stateSubject.updateState(e,{eur:t,converted:t*this.stateSubject.getState(e).exchangeRate})}updateRate(e,t){this.updateRateModel(n.EurToUsd,t),this.updateRateModel(n.EurToUah,t),this.updateRateModel(n.EurToGbr,t)}updateRateModel(e,t){const{eur:s}=this.stateSubject.getState(e);this.stateSubject.updateState(e,{exchangeRate:t,converted:s*t})}updateConvertedAmount(e,t){this.updateConvertedAmountModel(n.EurToGbr,t),this.updateConvertedAmountModel(n.EurToUsd,t),this.updateConvertedAmountModel(n.EurToUah,t)}updateConvertedAmountModel(e,t){const{exchangeRate:s}=this.stateSubject.getState(e);this.stateSubject.updateState(e,{eur:t/s,converted:t})}}(a),h=new class extends i{setModeAllInputListener(e){i.setOnInputListener(this.getInputElement("mode-all"),e)}setModeIndividualInputListener(e){i.setOnInputListener(this.getInputElement("mode-individual"),e)}setControlSlidersInputListener(e){i.setOnInputListener(this.getInputElement("control-sliders"),e)}setControlFieldsInputListener(e){i.setOnInputListener(this.getInputElement("control-fields"),e)}}("controls"),c=new class extends i{showPanelWithSliders(){this.getHTMLElement("sliders-panel").style.display="block",this.getHTMLElement("inputs-panel").style.display="none"}showPanelWithInputs(){this.getHTMLElement("sliders-panel").style.display="none",this.getHTMLElement("inputs-panel").style.display="block"}}("converter-panels"),p=new u("usdInputsConverter"),v=new u("uahInputsConverter"),g=new u("gbrInputsConverter"),m=new o("usdSlidersConverter"),E=new o("uahSlidersConverter"),S=new o("gbrSlidersConverter");new e(p,m,h,c,l,d,n.EurToUsd),new e(v,E,h,c,l,d,n.EurToUah),new e(g,S,h,c,l,d,n.EurToGbr)})();